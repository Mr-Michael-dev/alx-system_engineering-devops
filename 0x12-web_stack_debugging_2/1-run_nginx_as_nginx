#!/usr/bin/env bash
# Fix this container so that Nginx is running as the nginx user

# Create nginx user (if it doesn't exist)
useradd -r -s /sbin/nologin nginx

# Set ownership of nginx binary and configuration directory
chown -R nginx:nginx /usr/sbin/nginx /etc/nginx

# Modify nginx configuration (assuming default location)
sed -i '2i\user nginx;' /etc/nginx/nginx.conf

# Update listen directive to listen on all interfaces (0.0.0.0) on port 8080
sed -i 's/listen 80;/listen 0.0.0.0:8080;/' /etc/nginx/sites-availaible/default

# Restart nginx service
sudo -u nginx service nginx restart

echo "Nginx is now configured to run as user 'nginx' and listen on port 8080."

